<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Next Horizon: NCNU BAITIA — Demo</title>
  <meta name="description" content="NCNU BAITIA Master's demo: curriculum + course explanation. Local fallback implemented for safe demo on GitHub Pages." />
  <!-- Tailwind CDN (good for quick demos). For production, compile Tailwind into CSS. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest/dist/lucide.min.js" defer></script>

  <style>
    :root{
      /* Use consistent names: blue + accent (sky) */
      --ncnu-blue: 12 74 110;    /* rgb(12,74,110) - deep navy */
      --ncnu-accent: 0 191 255;  /* rgb(0,191,255) - sky blue accent */
      --page-bg: #f8fafc;
    }

    .bg-ncnu-blue { background-color: rgb(var(--ncnu-blue)); }
    .text-ncnu-blue { color: rgb(var(--ncnu-blue)); }
    .bg-ncnu-accent { background-color: rgb(var(--ncnu-accent)); }
    .text-ncnu-accent { color: rgb(var(--ncnu-accent)); }

    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background: var(--page-bg); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    /* Fade-in animation class (Tailwind-like) */
    .fade-in { animation: fadeIn .35s ease-out both; opacity: 0; }
    @keyframes fadeIn { to { opacity: 1; } }

    /* Spinner colors */
    .spinner { color: rgb(var(--ncnu-blue)); }

    /* Focus outline for accessibility */
    .focus-ring:focus { outline: 3px solid rgba(0,0,0,0.08); box-shadow: 0 0 0 3px rgba(2,132,199,0.15); }

    /* Small utility to style lucide icons once loaded */
    .icon { display:inline-block; vertical-align:middle; }
  </style>
</head>
<body class="antialiased min-h-screen text-gray-800">

  <main class="max-w-4xl mx-auto p-6">
    <header class="mb-8 flex items-center gap-4">
      <img src="" alt="" id="logo" class="h-12 w-12 rounded-md bg-ncnu-blue/10 hidden" />
      <div>
        <h1 class="text-2xl font-semibold text-ncnu-blue">Business Admin. & IT Innovation — NCNU (demo)</h1>
        <p class="text-sm text-gray-600">Interactive curriculum demo — ready for GitHub Pages</p>
      </div>
    </header>

    <section class="bg-white shadow-sm rounded-lg p-6 mb-6 fade-in">
      <h2 class="text-lg font-medium mb-2">Curriculum (sample)</h2>
      <p class="text-sm text-gray-600 mb-4">Click a course to get a one-sentence explanation. (Mock fallback is used when no API key is present.)</p>

      <ul id="coursesList" class="space-y-3">
        <!-- JavaScript will populate this -->
      </ul>
    </section>

    <section class="bg-white shadow-sm rounded-lg p-6 fade-in" aria-live="polite">
      <h3 class="text-base font-medium mb-2">Explanation</h3>
      <div id="explanationContainer" class="min-h-[64px] text-sm text-gray-700">
        <p id="explanationText" class="text-gray-500">Select a course to see a one-sentence explanation.</p>
      </div>
    </section>

    <footer class="mt-6 text-xs text-gray-500">
      <p>Demo page • No secrets committed. To enable live AI explanations, configure an API key securely (see comments in the HTML source).</p>
    </footer>
  </main>

  <script>
    /* ========== Configuration ==========

       IMPORTANT:
       - This demo includes a safe local fallback for "explain course" so the page works without secrets.
       - If you want real LLM generation, do NOT embed a real API key in a public HTML file.
         Instead, implement a server-side endpoint that keeps the key secret, or use GitHub Actions/Secrets and a backend.

       If you have a server proxy that accepts POSTs to /api/gen and returns { text: "..." } then
       you can set useLiveAPI = true and set API_ENDPOINT appropriately below.
    ==================================== */

    const useLiveAPI = false; // set true only if you have a secure server proxy
    const API_ENDPOINT = '/api/gen'; // Example server-side endpoint (NOT provided by this static demo)
    // const apiKey = ''; // Never place a real API key here in a public repo

    // Sample curriculum list (extracted & simplified from the Medium page)
    const COURSES = [
      "Information Systems Management",
      "Business Strategy & Innovation",
      "Data Analytics for Managers",
      "Digital Transformation",
      "Technology Policy & Ethics"
    ];

    // ---------- Minimal app state & render ----------
    window.appState = {
      loadingCourse: null,
      explanations: {}, // courseName => text
      lang: 'en'
    };

    function renderApp() {
      const ul = document.getElementById('coursesList');
      ul.innerHTML = '';
      COURSES.forEach(course => {
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between p-2 border rounded-md';

        const left = document.createElement('div');
        left.innerHTML = `<strong class="block">${escapeHtml(course)}</strong><span class="text-xs text-gray-500 block">Click to explain</span>`;

        const btn = document.createElement('button');
        btn.className = 'ml-4 px-3 py-1 bg-ncnu-blue text-white rounded focus-ring';
        btn.setAttribute('aria-label', `Explain ${course}`);
        btn.innerText = window.appState.loadingCourse === course ? 'Loading…' : 'Explain';
        btn.disabled = (window.appState.loadingCourse && window.appState.loadingCourse !== course);

        btn.addEventListener('click', () => handleExplainCourse(course));

        li.appendChild(left);
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    // Safe HTML escaping helper
    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // ---------- API helper with backoff (works only if you have a secure server proxy) ----------
    async function generateContentWithBackoff(payload, fetchUrl) {
      const MAX_RETRIES = 4;
      const BASE_DELAY_MS = 800;

      for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
        try {
          const resp = await fetch(fetchUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!resp.ok) {
            // If non-retryable client errors, break immediately
            if (resp.status >= 400 && resp.status < 500 && resp.status !== 429) {
              const text = await resp.text();
              throw new Error(`Non-retryable: ${resp.status} ${text}`);
            }
            // else throw to trigger retry logic
            throw new Error(`Server status ${resp.status}`);
          }

          const json = await resp.json();
          // Expecting { text: "..."} from our server proxy
          if (json && typeof json.text === 'string') return json.text.trim();
          // Try to extract from common shapes if you call external services directly:
          if (json?.candidates?.[0]?.content?.parts?.[0]?.text) {
            return json.candidates[0].content.parts[0].text.trim();
          }
          throw new Error('Unexpected response structure');

        } catch (err) {
          // Last attempt -> rethrow
          if (attempt === MAX_RETRIES - 1) throw err;
          // wait with exponential backoff + jitter
          const delay = BASE_DELAY_MS * Math.pow(2, attempt) + Math.random() * 300;
          await new Promise(r => setTimeout(r, delay));
        }
      }
    }

    // ---------- Explain course (uses live API if configured, otherwise local fallback) ----------
    async function handleExplainCourse(courseName) {
      if (window.appState.loadingCourse === courseName) return;
      window.appState.loadingCourse = courseName;
      updateExplanation(`${courseName}: Loading explanation...`);

      try {
        let explanation;
        if (useLiveAPI) {
          // Replace with your secure server endpoint that calls the LLM (server must keep API key secret)
          const payload = {
            systemInstruction: { parts: [{ text: "You are a concise academic advisor. Return a single-sentence explanation." }] },
            contents: [{ parts: [{ text: `Explain the course: ${courseName}` }] }]
          };
          explanation = await generateContentWithBackoff(payload, API_ENDPOINT);
        } else {
          // Local deterministic fallback (safe for public GitHub)
          explanation = mockExplainCourse(courseName);
          // add a short artificial delay so the UI feels natural
          await new Promise(r => setTimeout(r, 400));
        }
        window.appState.explanations[courseName] = explanation;
        updateExplanation(explanation);
      } catch (err) {
        console.error(err);
        const errMsg = 'Sorry — explanation failed. See console for details.';
        window.appState.explanations[courseName] = errMsg;
        updateExplanation(errMsg);
      } finally {
        window.appState.loadingCourse = null;
        renderApp(); // update button states
      }
    }

    function updateExplanation(text) {
      const container = document.getElementById('explanationText');
      container.textContent = text;
    }

    // A very small mock explanation routine (deterministic & safe)
    function mockExplainCourse(course) {
      const map = {
        "Information Systems Management": "Explores how organizations align IT systems with business strategy, operations and governance.",
        "Business Strategy & Innovation": "Focuses on designing competitive strategies that leverage technology-driven innovation.",
        "Data Analytics for Managers": "Covers how managers use data analysis to inform decisions, measure outcomes, and create value.",
        "Digital Transformation": "Examines organizational change driven by digital technologies, processes and culture.",
        "Technology Policy & Ethics": "Introduces legal, ethical and societal implications of technology adoption and innovation."
      };
      return map[course] || `${course}: A course linking business goals and technology capabilities.`;
    }

    // ---------- Initialize ----------
    function init() {
      // optionally set a logo src if you have one
      const logo = document.getElementById('logo');
      // logo.src = '...'; logo.classList.remove('hidden');

      renderApp();

      // small progressive enhancement: replace placeholders of lucide icons if present
      if (window.lucide) {
        // if lucide script loaded, run setup
        try { window.lucide && window.lucide.createIcons(); } catch(e){/* ignore */ }
      }
    }

    // Run init on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
